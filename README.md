# Auto Tests Application – Spring Boot + SQLite + Dockerized Setup

A production-ready **Spring Boot** application packaged as a **standalone JAR** (with embedded Tomcat), using **SQLite** for file-based persistence. This application is containerized via Docker with persistent volumes for database and logs.

---

## Project Structure & Build

### Build Tools
- **Java**: JDK 17
- **Build Tool**: Maven 3.8.5
- **Application**: Built as a **standalone JAR** with embedded Tomcat
- **Database**: Uses SQLite as embedded database (file-based)
- **Frontend (optional)**: Handled via `frontend-maven-plugin` (e.g., for Angular)

### Build & Packaging
- Maven profile: `prod`
- Output: `target/auto-tests-<version>.jar`

Build with:
```bash
mvn clean package -Pprod -DskipTests
```

---

## 🐳 Docker Setup (Production)

### 🔒 Environment Variables
Set these before starting the app (define in a `.env` file):
```bash
export AUTO_TEST_SECRET_KEY=your_base64_secret_key
export GOOGLE_CLIENT_ID=your_google_client_id
export GOOGLE_CLIENT_SECRET=your_google_client_secret
```

---

## 📄 Dockerfile

```dockerfile
# ===== STAGE 1: Build =====
FROM maven:3.8.5-openjdk-17 AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn clean package -Pprod -DskipTests

# ===== STAGE 2: Runtime =====
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
RUN mkdir -p /app/db /mnt/logs && chmod -R 777 /app/db /mnt/logs
ENV DB_PATH=/app/db/dbProd.sqlite
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

---

## 🧩 Docker Compose (docker-compose.yml)

```yaml
version: '3.8'

services:
  app:
    image: auto-tests-prod
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - .env
    ports:
      - "8080:8080"
    volumes:
      - auto-tests-db:/app/db
      - auto-tests-logs:/mnt/logs
    environment:
      DB_PATH: /app/db/dbProd.sqlite
    restart: unless-stopped

volumes:
  auto-tests-db:
  auto-tests-logs:
```

### 📂 Volume Mapping
| Volume Name       | Container Path   | Purpose                      |
|------------------|------------------|------------------------------|
| auto-tests-db     | `/app/db`        | Persistent SQLite database   |
| auto-tests-logs   | `/mnt/logs`      | Persistent application logs  |

---

## 🚀 Running the Application

### First-Time Setup (Detailed Steps)

#### Step 1: Prepare Environment Variables
You can export them directly or place them into a `.env` file (recommended for Docker Compose).

Example `.env` file:
```env
AUTO_TEST_SECRET_KEY=your_base64_secret_key
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
```

#### Step 2: Build the Project (Optional for Local Testing)
```bash
mvn clean package -Pprod -DskipTests
```
> This is not required if using Docker to build automatically.

#### Step 3: Start Application with Docker Compose
```bash
docker-compose up --build -d
```
This will:
- Build the image from source
- Create the necessary volumes (if not exist)
- Start the service on port `8080`

#### Step 4: Verify the App is Running
Open your browser at:
```
http://localhost:8080
```

Use the following command to verify the container is running:
```bash
docker ps
```

#### Step 5: Check Logs
```bash
docker-compose logs -f
```

---

### Redeploy with Code Changes
1. Update your code
2. Rebuild and restart app with:
```bash
docker-compose up --build -d
```
> Persistent data in volumes (`auto-tests-db`, `auto-tests-logs`) will not be affected.

---

### Stopping the App
Stop all services and remove containers:
```bash
docker-compose down
```

---

### Restarting Services
Restart without rebuilding:
```bash
docker-compose restart
```

---

### Viewing Logs
Follow logs for all services:
```bash
docker-compose logs -f
```

Or view logs for specific service:
```bash
docker-compose logs -f app
```

---

## Developer Notes

- Ensure `dbProd.sqlite` exists or is auto-generated by Hibernate.
- For projects using Angular or similar, build frontend before JAR:
```bash
npm run webapp:prod
```
- Logs and database files are accessible via Docker volumes or host mounts.

---

## Maintainer
Created by **Công Thoại**  
Email: [dcthoai@gmail.com](mailto:dcthoai@gmail.com)

